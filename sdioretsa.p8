pico-8 cartridge // http://www.pico-8.com
version 38
__lua__


overlay_state = 0

function _init()
	asteroids={}
	init_asteroid_count = 6 -- initial value
	reset_asteroids = true
	asteroid_count = 0

	-- there's only one ship so it's ok if global
	a = 0 -- the ship's angle
	thrust = 0 -- the ship's thrust
end


function rotate(x,y,cx,cy,angle)
	-- rotate everything when the ship turns
	local sina=sin(angle)
	local cosa=cos(angle)
 
	x-=cx
	y-=cy
	local rotx=cosa*x-sina*y
	local roty=sina*x+cosa*y
	rotx+=cx
	roty+=cy
 
	return rotx,roty
end

function add_new_asteroid()
	asteroid_count+=1
	add(asteroids, {
		ox=flr(rnd(128)), -- original asteroid position
		oy=flr(rnd(128)),
		rx=0, -- rotated asteroid position
		ry=0,
		xv = 0,
		yv = 0,
		tx = 0, -- rotated thrust x component
		ty = 0, -- rotated thrust y component
		speedx = (rnd(0.75)-0.25),
		speedy = (rnd(0.75)-0.25),
		size_accel = 0.33,


		update=function(self)
			-- the thrust happens in the y direction but
			-- after rotation could have an x component
			-- it effects everything else on screen
			self.tx = sin(a) * thrust
			self.ty = cos(a) * thrust
			self.ox+=(self.size_accel*self.speedx) + self.tx
			self.oy+=(self.size_accel*self.speedy) + self.ty

			-- the asteroid playing field is connected at the ends
			if (self.ox > 128) self.ox = 0
			if (self.ox < 0) self.ox = 128
			if (self.oy > 128) self.oy = 0
			if (self.oy < 0) self.oy = 128

			self.rx,self.ry=rotate(self.ox,self.oy,64,64,a)

		end,

		draw=function(self)
			pset(self.rx,self.ry,7)
		
		end
	})

end


function _update60()

	if (btn(1)) then
		a += 0.003
	end
	if (btn(0)) then
		a -= 0.003
	end

	if (btn(2)) then
		thrust += .09
	else
		thrust -= .09
	end
	if (thrust < 0) thrust = 0

	if (a>1) a = 0
	if (a<0) a = 1
	if (reset_asteroids) then
		reset_asteroids = false
		for i=0,init_asteroid_count,1 do
			add_new_asteroid()
		end
	end
	for a in all(asteroids) do
		a:update()
	end
end

function _draw()
	cls()
	for a in all(asteroids) do
		a:draw()
	end
	line(64,64,62,67,7)
	line(64,64,66,67,7)


	if (btn(2)) line(63,66,64,68,7)
	print('a:'..a, 0,0,7)
end
__gfx__
00000000000000000000000000007770000000000000000000000000000000077770000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000070007770000000007700000077000007777700007000000000000000000000000000000000000000000000000000000000000
00700700000000000770000000700000007770000070070000700700007000000000770000000000000000000000000000000000000000000000000000000000
00077000007770007007000007000000000007000700007077000070000700000000007000000000000000000000000000000000000000000000000000000000
00077000070007770000700007000000000000707000000700000700000070000000070000000000000000000000000000000000000000000000000000000000
00700700070000000000070007000000000000700700000000077000077700000007700000000000000000000000000000000000000000000000000000000000
00000000070000000000007007000000000077000700000000070000700000000070000000000000000000000000000000000000000000000000000000000000
00000000070000000000770007000000007700000070000000007700700000000007000000000000000000000000000000000000000000000000000000000000
00000000070000000007000007000000007000000070000000000070700000000000700000000000000000000000000000000000000000000000000000000000
00000000070000000007000000700000000770000700000000000007700000000000700000000000000000000000000000000000000000000000000000000000
00000000070000000000700000070000000007007000000000000070700000000000070000000000000000000000000000000000000000000000000000000000
00000000070000000000070000007000000000707000000000000700700000000000007000000000000000000000000000000000000000000000000000000000
00000000007000000000070000000700000000700700000770000700070000000000007000000000000000000000000000000000000000000000000000000000
00000000000700000000070000000070000000700070077007707000070000777700070000000000000000000000000000000000000000000000000000000000
00000000000070000000070000000007777777000007700000070000007077000077700000000000000000000000000000000000000000000000000000000000
00000000000007777777700000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000000000
